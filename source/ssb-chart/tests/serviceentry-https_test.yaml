suite: test serviceentry for https
templates:
  - serviceentry-https.yaml
tests:

  - it: should render one document for each egress rule
    values:
      - ./values/default-values.yaml
    set:
      egress:
        - "www.google.com"
        - "github.com"
        - "vg.no"
    asserts:
      - hasDocuments:
          count: 3
      - isKind:
          of: ServiceEntry

  - it: should render valid serviceentry
    values:
      - ./values/default-values.yaml
    set:
      egress:
        - "www.google.com"
    asserts:
      - equal:
          path: spec.hosts
          value:
          - www.google.com
      - equal:
          path: spec.exportTo
          value:
          - "."
      - equal:
          path: spec.ports
          value:
          - number: 443
            name: https
            protocol: HTTPS
      - equal:
          path: spec.resolution
          value: DNS
      - equal:
          path: spec.location
          value: MESH_EXTERNAL

